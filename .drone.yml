---
kind: pipeline
type: docker
name: Default

trigger:
  event:
    - push
    - tag

steps:

  - name: audit
    image: node:14
    commands:
      - npm audit --package-lock-only --production --audit-level=moderate

  - name: install
    image: node:12
    environment:
      NPM_CONFIG_IGNORE_SCRIPTS: true
    commands:
      - npm ci

  - name: test
    image: node:14
    commands:
      - npm test

  - name: check-coverage
    image: node:14
    commands:
      - npm run coverage

  - name: build
    image: node:14
    commands:
      - npm run build
      - npm ci --production

  - name: static-security-scan
    image: quay.io/natlibfi/njsscan
    commands:
      - njsscan dist

  - name: npm
    image: plugins/npm
    settings:
      registry: 'https://registry.npmjs.org/'
      token:
        from_secret: npm_token
    when:
      event: tag
---
kind: pipeline
type: docker
name: Update dependencies

trigger:
  event:
    - custom
  branch:
    - master

steps:

  - name: publish
    image: quay.io/natlibfi/drone-npm-git-publish
    settings:
      git_user_name: natlibfi-melinda-automation
      git_user_email: 65649125+natlibfi-melinda-automation@users.noreply.github.com
      git_ssh_key:
        from_secret: ssh_key
      git_gpg_key:
        from_secret: gpg_key
---
kind: secret
name: npm_token
data: a0qQf4wsFajYNYH2AVO7zcIeumcCbK532Vj6GtF46IF7nkn6EvAXqdBVD4rBnp3JPn5c64ClCPtTLfdgfRHwGw==
---
kind: secret
name: ssh_key
data: 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
---
kind: secret
name: gpg_key
data: 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
---
kind: signature
hmac: 9d75a45a0cbc8284c9b24544e7ebf710581624bb4be3045aaa6b69dd5f957a56

...
